<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Tracker</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0e17;
        }
        .list-group-item-action:hover {
            background-color: #212529 !important;
        }
        .loader {
            border: 4px solid #495057;
            border-top: 4px solid #0d6efd;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="container my-4 my-md-5">
        <!-- Controls Section -->
        <div class="row mb-4 g-3 align-items-center">
            <!-- Search Input -->
            <div class="col-md-5 col-lg-4">
                 <input type="text" id="search-input" placeholder="Search By Name or Symbol" class="form-control form-control-lg bg-dark text-white border-secondary placeholder-secondary">
            </div>

            <!-- Sort Buttons -->
            <div class="col-md-7 col-lg-8 d-flex justify-content-md-end gap-2">
                 <button id="sort-marketcap-btn" class="btn btn-outline-secondary btn-lg">
                    Sort By Mkt Cap
                </button>
                <button id="sort-percentage-btn" class="btn btn-outline-secondary btn-lg">
                    Sort By % Change
                </button>
            </div>
        </div>

        <!-- Crypto List Container -->
        <div class="bg-dark rounded-3">
             <div class="list-group" id="crypto-list-body">
                <!-- Rows will be inserted here by JavaScript -->
            </div>
             <div id="loader-container" class="d-flex justify-content-center align-items-center p-5">
                <div class="loader"></div>
            </div>
             <div id="error-container" class="alert alert-danger text-center p-4 d-none" role="alert"></div>
        </div>
        
        <!-- Hidden Fetch Buttons for functionality -->
        <div class="mt-8 text-center d-none">
            <button id="fetch-then-btn">Fetch with .then()</button>
            <button id="fetch-async-btn">Fetch with Async/Await</button>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_URL = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false';

            const listBody = document.getElementById('crypto-list-body');
            const fetchThenBtn = document.getElementById('fetch-then-btn');
            const fetchAsyncBtn = document.getElementById('fetch-async-btn');
            const searchInput = document.getElementById('search-input');
            const sortMarketCapBtn = document.getElementById('sort-marketcap-btn');
            const sortPercentageBtn = document.getElementById('sort-percentage-btn');
            const loaderContainer = document.getElementById('loader-container');
            const errorContainer = document.getElementById('error-container');

            let allCryptoData = [];
            let displayedData = [];
            
            let sortConfig = {
                key: 'market_cap',
                direction: 'desc'
            };

            const showLoader = () => {
                listBody.innerHTML = '';
                loaderContainer.classList.remove('d-none');
                errorContainer.classList.add('d-none');
            };

            const hideLoader = () => {
                loaderContainer.classList.add('d-none');
            };
            
            const showError = (message) => {
                hideLoader();
                errorContainer.textContent = `Error: ${message}`;
                errorContainer.classList.remove('d-none');
            }

            const fetchDataWithThen = () => {
                showLoader();
                fetch(API_URL)
                    .then(response => {
                        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                        return response.json();
                    })
                    .then(data => {
                        allCryptoData = data;
                        displayedData = [...allCryptoData];
                        applySort();
                        renderList();
                        hideLoader();
                    })
                    .catch(error => {
                        console.error('Error fetching data with .then():', error);
                        showError(error.message);
                    });
            };

            const fetchDataWithAsyncAwait = async () => {
                showLoader();
                try {
                    const response = await fetch(API_URL);
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    const data = await response.json();
                    allCryptoData = data;
                    displayedData = [...allCryptoData];
                    applySort();
                    renderList();
                    hideLoader();
                } catch (error) {
                    console.error('Error fetching data with async/await:', error);
                    showError(error.message);
                }
            };

            const renderList = () => {
                listBody.innerHTML = ''; 
                
                if (displayedData.length === 0) {
                     listBody.innerHTML = `<div class="list-group-item bg-dark text-muted text-center p-5">No data available or matches your search.</div>`;
                     return;
                }

                displayedData.forEach(coin => {
                    const priceChange = coin.price_change_percentage_24h;
                    const priceChangeColor = priceChange >= 0 ? 'text-success' : 'text-danger';
                    const priceChangeSign = priceChange >= 0 ? '+' : '';

                    const row = document.createElement('div');
                    row.className = 'list-group-item bg-dark text-white border-secondary p-3';

                    row.innerHTML = `
                        <div class="row align-items-center g-3">
                            <!-- Coin -->
                            <div class="col-lg-3 col-md-12 col-sm-6 d-flex align-items-center gap-3">
                                <img src="${coin.image}" alt="${coin.name}" style="width: 40px; height: 40px;" class="rounded-circle">
                                <div>
                                    <h5 class="mb-0 fw-bold">${coin.symbol.toUpperCase()}</h5>
                                    <small class="text-secondary">${coin.name}</small>
                                </div>
                            </div>
                            <!-- Price -->
                            <div class="col-lg-2 col-md-3 col-sm-6 text-sm-end">
                                <h6 class="mb-0">$${coin.current_price.toLocaleString()}</h6>
                            </div>
                            <!-- 24h Change -->
                             <div class="col-lg-2 col-md-3 col-sm-6 text-sm-end">
                                <h6 class="mb-0 ${priceChangeColor}">${priceChangeSign}${priceChange.toFixed(2)}%</h6>
                            </div>
                            <!-- Total Volume -->
                            <div class="col-lg-2 col-md-3 col-sm-6 text-sm-end">
                                <small class="text-secondary">Volume</small>
                                <div class="fw-medium">$${coin.total_volume.toLocaleString()}</div>
                            </div>
                            <!-- Market Cap -->
                            <div class="col-lg-3 col-md-3 col-12 text-sm-end mt-3 mt-lg-0">
                                <small class="text-secondary">Mkt Cap</small>
                                <div class="fw-medium">$${coin.market_cap.toLocaleString()}</div>
                            </div>
                        </div>
                    `;
                    listBody.appendChild(row);
                });
            };
            
            const applySort = () => {
                 displayedData.sort((a, b) => {
                    if (a[sortConfig.key] < b[sortConfig.key]) {
                        return sortConfig.direction === 'asc' ? -1 : 1;
                    }
                    if (a[sortConfig.key] > b[sortConfig.key]) {
                        return sortConfig.direction === 'asc' ? 1 : -1;
                    }
                    return 0;
                });
            }
            
            const handleSort = (key) => {
                 if (sortConfig.key === key) {
                    sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    sortConfig.key = key;
                    sortConfig.direction = 'desc';
                }
                applySort();
                renderList();
            }

            const handleSearch = () => {
                const searchTerm = searchInput.value.toLowerCase();
                displayedData = allCryptoData.filter(coin => 
                    coin.name.toLowerCase().includes(searchTerm) || 
                    coin.symbol.toLowerCase().includes(searchTerm)
                );
                applySort();
                renderList();
            };

            fetchThenBtn.addEventListener('click', fetchDataWithThen);
            fetchAsyncBtn.addEventListener('click', fetchDataWithAsyncAwait);
            searchInput.addEventListener('input', handleSearch);
            sortMarketCapBtn.addEventListener('click', () => handleSort('market_cap'));
            sortPercentageBtn.addEventListener('click', () => handleSort('price_change_percentage_24h'));

            fetchDataWithAsyncAwait();
        });
    </script>
</body>
</html>

